# Leaf
一个多功能、易扩展、可二次开发的微信商城系统

Leaf 旨在实现一个对于商户易于管理、使用、低配置维护成本的微信商城系统；而对于开发者则尽可能的提供更多的开放接口，减少二次开发的难度。

Leaf 使用 Python 3.x + Flask + MongoDB 的架构开发；生产环境下建议使用 Nginx + Gunicorn 对外提供服务。

Leaf 继承了 Flask 易于扩展与轻量的特点，通过 **功能装饰器** 和 **事件消息机制** 极大化简化了二次开发的流程，从而可以在不破坏原有代码的情况下实现对系统功能的扩展。

Leaf 完全的 **前后端分离** 与 **Restful风格的API** 则为前端开发带来了很大的方便性。

Leaf 同时实现了 **插件系统支持**，只需要简单的接口配置，就可以使第三方的功能在 Leaf 上运行与管理，配合 Leaf 已经实现的 **计划任务机制** 可以实现强大的插件功能。

---

### 使用特性介绍：

1. **Leaf - 公众号管理系统**

   - 公众号内用户普通消息全面支持

     无需专业的开发知识，通过简单的配置用户就可以对用户主动发送的消息进行定制化回复，包括用户发送的图片，语音消息等。

     而如果在微信公众平台的开发配置中开启了语音识别，则可以实现基础的语音识别回复。

     而有二次开发能力的用户则可以非常轻松地使用 Leaf 所提供的 API 绑定自己的消息视图函数进行自定义回复；而开发者更可以通过连接外部 API 实现丰富多彩的消息回复策略。

   - 公众号内用户事件消息的支持

     由于事件消息处理的业务复杂性，当普通用户使用时可以实现基本的消息管理与数据存档。

     例如用户进入微信公众号时可以自行选择是否发送地理位置信息，普通商户则可以默认的将地理位置入库。

     而对于有开发能力的用户，则可以通过 Leaf 提供的 API 进行丰富的自定义功能开发，配合业务逻辑甚至可以轻松实现物联网应用。

   - 公众号模板消息与群发消息的支持

     通过 Leaf 实现的 API 对接微信公众平台，使得编辑模板与群发消息等操作变得更加容易，而本地文件的缓存则可以让用户轻松地根据条件查找需要使用的文件。

   - 微信文件系统的同步管理

     通过 Leaf 实现的文件同步管理系统，用户可以轻松地管理存储在微信远端的文件。

     配合上面的消息支持，使得用户无需在两个平台（商户平台与微信公众平台之间）相互切换，更轻松的实现公众号管理。

2. **Leaf - 商城系统**

   - 用户系统

     Leaf 实现了用户管理系统，通过友好的 UI 界面就可以对用户以及用户组进行配置、权限管理、增删改查等的操作。

     第三方登陆的支持则实现了对用户系统的扩展；Leaf 内部已经实现了微信登录的支持，减少用户登陆复杂性，增加用户粘性。

   - 产品/商品系统

     Leaf 的商品系统实现了商品的基础增删改查操作，而商品可以在用户定义的产品类中生成，减少商户的管理难度。

     商品分类系统采用 tag 实现，无需复杂的类别配置，便可以让用户方便的对商品进行搜索与管理。

   - 订单系统

     Leaf 的订单系统配合微信支付，使得商户可以在完全没有配置的情况下生成订单与收款信息。

     而订单系统在数据库级别与用户系统配合，与 Leaf 实现的轻量的评论系统配合，实现基础的订单管理与统计。

   - 统计系统

     通过 Leaf  的统计系统与以上的用户系统，订单系统配合，可以展现给商户一套实时的盈利统计数据。

     商户在后台可以轻松地查看这些数据，以此分析用户行为与产品受欢迎程度等。

     而对于有开发能力的用户，则可以通过开发插件对于数据进行进一步的使用与分析。

3. **Leaf - 支付支持**
  - 微信支付
     Leaf 内部已经实现了微信支付接口的支持，用户仅需要在后台简单的进行关键参数配置既可方便的使用。
   - 支付宝
     Leaf 计划后期实现支付宝支付的支持。


### 开发特性介绍：
1. **完全前后端分离**
   Leaf 在开发时采用了完全前后端分离的开发模式；前后端交换数据统一采用 JSON 格式。当前端项目版本迭代时，无需冷启动更改模板缓存，快速上线，方便模块化开发。

2. **RESTFul 风格 API 接口**

   Leaf 在开发时采用了 “伪RESTFul” 风格的接口开发，即在面向无状态的情况下使用 GET 请求获取数据，而使用 POST 请求在相应业务节点模拟 DELETE/PUT 等操作。力求在尽量减少前端开发难度的情况下规范化 API 接口模式。

3. **事件消息机制**

   Leaf 内部实现了一套完整的事件回调机制，在进行二次开发时，不需要改动/破坏项目源代码，而是在外部以注入函数到相应的事件中实现拓展。

4. **插件系统**

   Leaf 实现了插件系统的支持，而使用动态 URL 的匹配可以实现插件的热扩展。同时，在应用级别提供了重载入插件模块的 API，当插件升级之后，无需重启整个系统来进行部署。

5. **功能装饰器**

   在 Leaf 的核心模块中提供了一些比较有用的功能性装饰器（例如线程执行装饰器、计时器、参数检查等等），这些装饰器在扩展时可以直接使用，从而实现在不破坏代码完整性的同时方便二次开发。

7. **减少外部依赖**

   Leaf 在开发时尽力减少了第三方库的依赖，当出现问题时，尽力减少 Debug 的成本。

8. **日志与错误系统**

   Leaf 内部集成了日志与错误系统支持，同时在 error.message 中允许开发者自定义错误消息；在使用时仅需要实例化一个错误与日志记录器即可。而在配置文件中可以详细的配置日志的记录级别。

9. **计划任务机制**

   通过使用核心中的 Schedule 模块，二次开发时能够方便的创建任务计划，以任意的时间间隔定时的执行内部任务。配合插件系统，可以实现定时的数据收集统计、定时邮件发送、API 状态检测等等功能。

目前 Leaf 的核心部分基本已经开发完成；插件系统等较为复杂的实现仍处于开发阶段。可能会进行大范围的代码重构，甚至架构变动等。

而在开发完成之后，会尽快的集成单元测试。同时，API 接口文档与二次开发文档也将在项目完成之后开始编写。

在项目进入发布稳定阶段之后，作者将着力于插件的开发与更多接口的提供，尽可能的将 Leaf 变得更完美，更加易用。

祝使用愉快 :)